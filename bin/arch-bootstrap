#!/bin/bash

set -euo pipefail

current_dir=$(pwd)
ARCH=$(uname -m)
[ $ARCH = "aarch64" ] && ARCH="arm64"

sudo pacman -Syu --noconfirm

if ! command -v yay >/dev/null 2>&1; then
  echo "installing yay"
  cd /tmp
  sudo pacman -S --needed git base-devel && \
    git clone https://aur.archlinux.org/yay.git \
    && cd yay && makepkg -s
fi

binaries=(
  cmake
  openssl  
  zsh   
  bash
  openvpn
  curl
  unzip
  tar
  fzf
  ripgrep
  jq
  make
  stow

  # development
  go
  rustup
  aws-cli
  github-cli
  lua
  tmux
  neovim
  yarn
  pnpm

  # desktop environment with i3 
  # plasma-desktop
  # i3-wm
  # i3status
  # i3lock
  # rofi
  # wmctrl
  # xautolock
  # feh
  # picom
  # qt5ct

  # desktop environment with hyprland
  qt5-wayland 
  qt5ct
  qt6-wayland 
  qt6ct
  qt5-svg
  qt5-quickcontrols2
  qt5-graphicaleffects
  gtk3 
  polkit-gnome 
  pipewire 
  wireplumber 
  wl-clipboard 
  cliphist 
  python-requests 
  pacman-contrib
  mako 
  waybar
  swww 
  swaylock-effects 
  wofi 
  wlogout 
  xdg-desktop-portal-hyprland 
  swappy 
  grim 
  slurp 
  thunar 
  thunar-archive-plugin 
  btop
  mpv
  pamixer 
  pavucontrol 
  brightnessctl 
  bluez 
  bluez-utils 
  blueman 
  network-manager-applet 
  gvfs 
  file-roller
  papirus-icon-theme 
  lxappearance 
  xfce4-settings
  nwg-look-bin
  sddm
  
   # applications
  aws-vault
  kitty
  docker
  dolphin
  kio-gdrive
  thunderbird

  # discord
  # slack

  # fonts
  ttf-fantasque-nerd
  ttf-jetbrains-mono-nerd 
  noto-fonts-emoji 
)

echo "installing pacman packages"
sudo pacman -S ${binaries[@]} --noconfirm

yay_packages=(
  brave-bin  
  postman-bin
  1password-cli
)

echo "installing yay packages"
yay -S ${yay_packages[@]} --noconfirm

if ! command -v 1password >/dev/null 2>&1; then
  echo "installing 1password.."
  cd /tmp
  curl -sSO https://downloads.1password.com/linux/tar/stable/$ARCH/1password-latest.tar.gz
  sudo tar -xf 1password-latest.tar.gz
  sudo mkdir -p /opt/1Password
  sudo mv 1password-*/* /opt/1Password
  sudo /opt/1Password/after-install.sh
  cd $current_dir
fi

echo "installing default rust.."
rustup default stable

echo "installing fnm.."
cargo install fnm
fnm install --lts
fnm default lts-latest

echo "ðŸŽ‰  completed arch bootstrap"
