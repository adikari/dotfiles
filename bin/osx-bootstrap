#!/bin/bash

set -euo pipefail

# install homebrew if not already installed
if ! type "brew" > /dev/null 2>&1; then
  echo "installing homebrew..."
  /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)"
fi

brew tap ringohub/redis-cli

echo "updating brew..."
brew update

# install binaries
binaries=(
 bash
 ctags
 fortune
 git
 gh
 go
 lua
 openssl
 readline
 tmux
 nvim
 gradle
 kotlin-language-server
 yarn
 reattach-to-user-namespace
 svn
 tmuxinator
 asdf
 gpg # required by asdf nodejs plugin
 fzf
 peco
 emojify
 redis-cli
)

echo "installing binaries..."
brew install ${binaries[@]}

# install cask applications
apps=(
  cmake
  dropbox
  iterm2
  docker
  osxfuse
  sequel-pro
  brave-browser
  1password
  vlc
  google-backup-and-sync
  adobe-acrobat-reader
  slack
  zoom
)

echo "installing applications..."
brew install --cask ${apps[@]}

# configure fzf bindings
/usr/local/opt/fzf/install --all

# install rust and rust analyzer
echo "installing rust and rust analyzer"
if ! type "rustup" > /dev/null 2>&1; then
  curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y
else
  echo "rustup is already installed."
fi

echo "tapping cask fonts"
brew tap homebrew/cask-fonts

# install fonts
fonts=(
  font-clear-sans
  font-roboto
  font-fantasque-sans-mono
)

echo "installing fonts..."
brew install ${fonts[@]}

echo "installing powerline fonts..."
if [ -f "$HOME/Library/Fonts/Inconsolata for Powerline.otf" ]; then
  echo "powerline is fonts already installed."
else
  currentdir=$(pwd)
  cd /tmp
  git clone https://github.com/powerline/fonts.git && cd fonts
  chmod +x install.sh
  ./install.sh
  cd $currentdir
fi

echo "cleaning up"
rm -rf /tmp/fonts
brew cleanup

