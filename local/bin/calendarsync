#!/bin/env bash

# █░█ ▄▀█ █▀█ █ ▄▀█ █▄▄ █░░ █▀▀ █▀
# ▀▄▀ █▀█ █▀▄ █ █▀█ █▄█ █▄▄ ██▄ ▄█

config="$XDG_CONFIG_HOME/vdirsyncer/config"

# █░█ ▄▀█ █░░ █ █▀▄ ▄▀█ ▀█▀ █ █▀█ █▄░█
# ▀▄▀ █▀█ █▄▄ █ █▄▀ █▀█ ░█░ █ █▄█ █░▀█
 
pgrep -x vdirsyncer >/dev/null && { echo "vdirsyncer is already running." ; exit ;}
ping -q -c 1 1.1.1.1 > /dev/null || { echo "No internet connection detected."; exit ;}


# █▀▀ █░█ █▄░█ █▀▀ ▀█▀ █ █▀█ █▄░█ █▀
# █▀░ █▄█ █░▀█ █▄▄ ░█░ █ █▄█ █░▀█ ▄█

notify() { 
  $HOME/.local/bin/notify "$1" "$2" \
    -a calendar -i calendar -u critical 
}

syncandnotify() {
  # vdirsyncer sync

  # systemctl --user stop $(systemd-escape "test : hello").timer
  
  IFS=$'\n' 
  events=($(khal list --notstarted --day-format='' --format="{start-time-full}#{status}#{title}#{location}" today today))

  if [ ${#events[@]} -eq 0 ]; then
    echo "No new events to schedule"
    return
  fi

  for item in "${events[@]}"; do
    IFS="#" read -r time status title location <<< "$item"
    
    # Print the extracted values for each item
    echo "Time: $time"
    echo "Status: $status"
    echo "Title: $title"
    echo "Location: $location"
      
    # Add a separator for clarity
    echo "--------------------------------------"
  done
}


# █▀ █▄█ █▄░█ █▀▀
# ▄█ ░█░ █░▀█ █▄▄

syncandnotify &
wait
