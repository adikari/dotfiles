#!/bin/bash

set -eo pipefail

file=$HOME/dotfiles/secrets

usage="USAGE: $(basename "$0") [-v|--var] <variable>
where:
    -v  | --var         variable to read
    -h  | --help        show this help text"

while [ $# -gt 0 ]; do
    if [[ $1 =~ "--"* ]]; then
        case $1 in
            --help|-h) echo "$usage"; exit; ;;
            --var|-v) VAR=$2;;
        esac
    fi
    shift
done

if [ -z "$VAR" ]; then
  echo "variable to read must be specified by --var or -v"
  exit 1;
fi

content=$(gpg --quiet --for-your-eyes-only --decrypt $file)
value=$(echo -e "$content" | awk -F'=' -v var="$VAR" '$1 == var {print $2}')
echo "$value"
